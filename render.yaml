services:
  - type: web
    name: gameprice-scraper
    runtime: python3
    plan: free
    buildCommand: |
      apt-get update && apt-get install -y wget gnupg ca-certificates procps curl &&
      wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | gpg --dearmor -o /usr/share/keyrings/google-chrome.gpg &&
      sh -c 'echo "deb [arch=amd64 signed-by=/usr/share/keyrings/google-chrome.gpg] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list' &&
      apt-get update &&
      apt-get install -y google-chrome-stable fonts-ipafont-gothic fonts-wqy-zenhei fonts-thai-tlwg fonts-kacst fonts-freefont-ttf libxss1 &&
      rm -rf /var/lib/apt/lists/* &&
      pip install --no-cache-dir -r requirements.txt &&
      playwright install chromium &&
      python -c "import playwright; print('Playwright verification successful')"
    startCommand: python main.py
    healthCheckPath: /health
    envVars:
      - key: SUPABASE_URL
        value: https://gjqybghjbvgncetjicsa.supabase.co
      - key: SUPABASE_SERVICE_KEY
        value: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdqcXliZ2hqYnZnbmNldGppY3NhIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MjE4OTM3MywiZXhwIjoyMDc3NzY1MzczfQ.M2dX9HBgrcUxPwLs25gbM0QJynoq1xyyFtXn4GAF0Z8
      - key: GEMINI_API_KEY
        value: AIzaSyArBovqbaqSea4-ncIHAOL7BzmMzNm2de0
      - key: DEBUG_MODE
        value: false
      - key: PYTHON_VERSION
        value: 3.11.9
